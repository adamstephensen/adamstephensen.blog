---
title: Upgrading from ASP.NET.Identity 1.0 to 2.0
permalink: 2014/05/02/upgrading-from-asp-net-identity-1-0-to-2-0/
layout: post
tags:
  - .NET
  - Identity
comments: true
---

<p>ASP.NET.Identity 2.0 is out, and it adds a bunch of great features.</p> <p>- Two-Factor Authentication (SMS, Email or custom)<br>- Account Lockout<br>- Account Confirmation via Email<br>- Password Reset<br>- Sign out everywhere<br>- Choose your Primary Key type (string, int, Guid)<br>- IQuerable Users and Roles <br>- Delete User<br>- Enforcing Unique User Names</p> <p> </p> <p>The upgrade was more fiddly than I thought it would be. Here is what I had to do. I hope it helps.</p> <p> </p> <p>1. Update Entity Framework to 6.1</p> <p>2: Update all your OWIN components if they already exist in your project.<br></p> <p>(Yes. NuGet should handle this for me. It didn’t. Upgrading the Owin components before the Identity packages resolved some issues for me)</p> <p><a href="./images/image.png"><img title="image" style="border-top:0;border-right:0;background-image:none;border-bottom:0;padding-top:0;padding-left:0;border-left:0;display:inline;padding-right:0;" border="0" alt="image" src="./images/image.png" width="488" height="416"></a></p> <p> </p> <p>3: Update Microsoft ASP.Net Identity Core and then ASP.Net Identity EntityFramework</p> <p><a href="./images/image1.png"><img title="image" style="border-top:0;border-right:0;background-image:none;border-bottom:0;padding-top:0;padding-left:0;border-left:0;display:inline;padding-right:0;" border="0" alt="image" src="./images/image1.png" width="488" height="296"></a></p> <p> </p> <p>4: Your model has now been updated to v2.0 !</p> <p>If you are running Code First Migrations you now need to create a migration to reflect the changes to the database.</p> <p><a href="./images/image2.png"><img title="image" style="border-top:0;border-right:0;background-image:none;border-bottom:0;padding-top:0;padding-left:0;border-left:0;display:inline;padding-right:0;" border="0" alt="image" src="./images/image2.png" width="618" height="201"></a></p> <p>Figure: When you try to create the migration, it will tell you that the model backing the db context has changed. To resolve it, you need to update the constructor of your dbcontext.</p> <p> </p> <p><a href="./images/image3.png"><img title="image" style="border-top:0;border-right:0;background-image:none;border-bottom:0;padding-top:0;padding-left:0;border-left:0;display:inline;padding-right:0;" border="0" alt="image" src="./images/image3.png" width="588" height="150"></a></p> <p>Figure: Adding ‘, throwIfV1Schema:false’ as a parameter to the constructor will allow you to run the application, and create the required Code First Migration.</p> <p> </p> <p><a href="./images/image4.png"><img title="image" style="border-top:0;border-right:0;background-image:none;border-bottom:0;padding-top:0;padding-left:0;border-left:0;display:inline;padding-right:0;" border="0" alt="image" src="./images/image4.png" width="581" height="57"></a></p> <p>Figure: After updating the db context constructor, Add-Migration works as expected.</p> <p> </p> <p><a href="./images/image5.png"><img title="image" style="border-top:0;border-right:0;background-image:none;border-bottom:0;padding-top:0;padding-left:0;border-left:0;display:inline;padding-right:0;" border="0" alt="image" src="./images/image5.png" width="602" height="353"></a></p> <p>Figure: You can now inspect the changes to the schema in the Migration.</p> <h2>Upgraded !</h2> <p>Now check out the links below to get help on how to implement the great new features in ASP.Net Identity 2.0.</p> <p> </p> <h3>Resources: </h3> <p>ASP.NET MVC and Identity 2.0: Understanding the Basics</p> <p><a title="http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx" href="http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx">http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx</a></p> <p>- a great overview of Identity 2.0</p> <p> </p> <p>Announcing RTM of ASP.NET Identity 2.0.0</p> <p><a title="http://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx" href="http://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx">http://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx</a></p> <p>- definitely worth reading !</p> <p>- contains list of features and some upgrade notes</p>

